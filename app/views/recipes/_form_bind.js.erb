$('#ingredients a.add').live('click', function() {
  var html = $('#new-ingredient').html();
  html = $(html.replace(/REPLACE_ME/g, new Date().getTime().toString()));
  $('#ingredients').append(html);
  html.find('.ingredient:text').autocomplete(
    '/recipes/ingredient_search');

  return false;
});

$('#ingredients .close').live('click', function() {
  $(this).parents('.ingredient').hide().find('.remove').val('1');  
});


var bindForm = function($el) {

  $el.find('#recipe_category_attributes_name').autocomplete(
    '/recipes/category_search');
  $el.find('.ingredient:text').autocomplete(
    '/recipes/ingredient_search');


  $el.ajaxForm({
    beforeSubmit: function(ignored, $form) {
      var submit = $form.find(':submit').hide();
      $(
        "<%= escape_javascript image_tag('ajax-small.gif') %>"
      ).insertAfter(submit);
    },

    success: function(data, a, b, $form) {
      data = $(data);
      $('#card .content').html(data);
      if (data.find('#errorExplanation').length > 0) {
        bindForm($('#card form'));
      }
    }
  });
};

bindForm($('form'));
