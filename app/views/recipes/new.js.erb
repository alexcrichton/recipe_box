$('#card .content').html(
  "<%= escape_javascript render(:template => 'recipes/new.html') %>"
);

$('#ingredients a.add').die('click').live('click', function() {
  var html = $('#new-ingredient').html();
  html = $(html.replace(/REPLACE_ME/g, new Date().getTime().toString()));
  $('#ingredients').append(html);
  html.find('.ingredient:text').autocomplete(
    '/recipes/ingredient_search', {selectFirst:false});

  html.find('.quantity').focus();

  return false;
});

$('#ingredients .close').die('click').live('click', function() {
  $(this).parents('.ingredient').hide().find('.remove').val('1');
});

$('#ingredients input[type=text]').die('click').live('keydown', function(e) {
  if (e.keyCode == 13) { // enter key
    var $parent = $(e.srcElement).parents('div.ingredient');

    if ($parent.next().length == 0) {
      $('#ingredients a').click();
      e.preventDefault();
      return false;
    }
  }
  return true;
});

<%= render 'form_bind' %>
